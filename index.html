<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Skin Constructor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Burbank+Big+Condensed:wght@900&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Luckiest Guy';
            font-weight: 900;
            overflow: hidden;
            letter-spacing: 0.05em;
        }
        /* Ensure all buttons inherit the body font */
        button {
            font-family: inherit;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #character-display-bg {
            touch-action: none; /* Prevents scrolling/zooming on touch devices while dragging */
        }
        .character-part {
            position: absolute;
            height: auto;
            transition: opacity 0.3s ease-in-out;
            cursor: grab;
            user-select: none; /* Prevent text selection during drag */
        }
        .character-part:active {
            cursor: grabbing;
        }

        /* --- ADJUST SIZES FOR EACH PART HERE --- */
        #character-head {
            width: 50%; /* Adjust size of the head */
            max-width: 250px;
        }
        #character-body {
            width: 80%; /* Adjust size of the body */
            max-width: 400px;
        }
        #character-legs {
            width: 80%; /* Adjust size of the legs */
            max-width: 400px;
        }
        /* ----------------------------------------- */

        /* --- ADJUST INITIAL POSITIONS HERE --- */
        #character-head {
            top: 5%; /* Vertical Position */
            left: 50%; /* Horizontal Position */
            transform: translateX(-50%);
            z-index: 3;
        }
        #character-body {
            top: 5%; /* Vertical Position */
            left: 50%; /* Horizontal Position */
            transform: translateX(-50%);
            z-index: 2;
        }
        #character-legs {
            top: 8%; /* Vertical Position */
            left: 50%; /* Horizontal Position */
            transform: translateX(-50%);
            z-index: 1;
        }
        /* ----------------------------------- */

        .carousel-item.selected {
            box-shadow: 0 0 0 3px #3b82f6; /* Creates the cropped stroke effect */
            transform: scale(1.1);
        }
        .tab-btn {
            color: black;
            opacity: 0.7;
            background: none;
            border: none;
            padding: 0.5rem 1.5rem; /* Give buttons consistent padding */
            text-transform: uppercase;
            position: relative;
            z-index: 1;
            text-align: center;
        }
        .tab-btn.active {
            color: black;
            opacity: 1;
        }
        #tab-background {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: white;
            border-radius: 9999px; /* full pill shape */
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 0;
        }
    </style>
</head>
<body class="bg-black">

    <div id="app-container" class="w-screen h-screen bg-black relative flex flex-col">
        <div id="constructor-screen" class="w-full h-full flex flex-col items-center text-white">
            
            <div class="absolute top-0 left-0 right-0 p-4 flex justify-between items-center z-20">
                 <button id="back-btn" class="text-2xl font-black opacity-0 pointer-events-none transition-opacity">Back</button>
                 <div class="text-center">
                    <span id="constructor-title" class="font-black text-2xl">SELECT BACKGROUND</span>
                 </div>
                 <button id="next-btn" class="text-2xl font-black">Next</button>
            </div>

            <div id="character-display-bg" class="w-full h-full flex items-center justify-center transition-all duration-500 overflow-hidden">
                <div class="relative w-full h-full">
                    <img id="character-legs" src="" class="character-part" alt="Character legs">
                    <img id="character-body" src="" class="character-part" alt="Character body">
                    <img id="character-head" src="" class="character-part" alt="Character head">
                </div>
            </div>

            <div class="absolute bottom-0 left-0 right-0 w-full p-4 z-10 bg-transparent">
                <!-- Container for Background Carousel -->
                <div id="background-carousel-container">
                     <div id="background-carousel" class="flex items-center space-x-3 overflow-x-auto p-4 no-scrollbar max-w-4xl mx-auto"></div>
                </div>

                <!-- Container for Parts Selection -->
                <div id="parts-selection-container" class="hidden">
                    <div class="flex justify-center">
                        <div id="tab-container" class="relative flex justify-center w-full max-w-sm mb-4 items-center h-14 bg-blue-600 rounded-full">
                             <div id="tab-background"></div>
                            <button data-category="heads" class="tab-btn text-2xl font-black transition-colors duration-300">Head</button>
                            <button data-category="bodies" class="tab-btn text-2xl font-black transition-colors duration-300">Body</button>
                            <button data-category="legs" class="tab-btn text-2xl font-black transition-colors duration-300">Legs</button>
                        </div>
                    </div>
                    <div id="parts-carousel" class="flex items-center space-x-3 overflow-x-auto p-4 no-scrollbar max-w-4xl mx-auto">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const constructorScreen = document.getElementById('constructor-screen');
            const characterDisplayBg = document.getElementById('character-display-bg');
            const partsCarousel = document.getElementById('parts-carousel');
            const backgroundCarouselContainer = document.getElementById('background-carousel-container');
            const backgroundCarousel = document.getElementById('background-carousel');
            const partsSelectionContainer = document.getElementById('parts-selection-container');
            const tabButtons = document.querySelectorAll('.tab-btn');
            const backButton = document.getElementById('back-btn');
            const nextButton = document.getElementById('next-btn');
            const constructorTitle = document.getElementById('constructor-title');
            const tabContainer = document.getElementById('tab-container');
            const tabBackground = document.getElementById('tab-background');
            
            const characterParts = {
                heads: document.getElementById('character-head'),
                bodies: document.getElementById('character-body'),
                legs: document.getElementById('character-legs'),
            };

            const items = {
                backgrounds: [
                    { id: 'bg1', url: 'radial-gradient(circle, #a3ff00, #45c900)', type: 'gradient' },
                    { id: 'bg2', url: 'radial-gradient(circle at 50% 50%, #f59e0b, #ef4444, #ea580c)', type: 'gradient' },
                    { id: 'bg3', url: 'radial-gradient(circle, #8b5cf6, #4f46e5, #3730a3)', type: 'gradient' },
                    { id: 'bg4', url: 'linear-gradient(to top, #f97316, #ec4899, #d946ef)', type: 'gradient' },
                    { id: 'bg5', url: 'radial-gradient(circle, #2dd4bf, #5b21b6, #312e81)', type: 'gradient' },
                    { id: 'bg6', url: 'radial-gradient(circle, #1e1b4b, #312e81, #4c1d95)', type: 'gradient' }
                ],
                heads: ["https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971375703x802767633328860300/agent.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971388768x916935544764463400/agent_covered.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971399912x768135997977279200/blue.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971417255x140647736990435760/brite.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971431182x785302117856104600/bullseye.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971452829x973463900990895400/bunny.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971465559x387249444214299500/burnout.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971479598x830099350874202700/cactus.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971488225x785313479123397800/catwoman.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971499637x828031539975146100/circuit.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971511249x601356248768484500/criterion.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971527223x374625254071390600/dark_bomber.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971541046x691557527722229900/darkhair.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971557526x787789830780373000/default.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971571833x918796843050960800/demi.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971581790x559393647245237600/dino.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971593804x464066855221220800/ghoul.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971602732x550132576147566600/ginger.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971612582x138402146417613950/glasses.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971623611x363470471257275140/headband.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971634983x960910663309114500/heidi.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971646868x271309331837076740/leprechaun.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971657257x816333453880744700/mando_female.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971674536x996965432411001100/military_helmet.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971688253x705787158716326300/onesie.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971698726x990777663195273200/paint.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971712267x294957822637064100/pink_bear.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971725685x925206546685775700/pink_pigtails.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971737744x386079082688803840/plague_doctor.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971752238x564101913578314300/radiant.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971783750x387523394830777200/ravage.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971797320x370543437412626900/red_jade.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971809436x896020612821981200/redagent.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971822982x366474151741500200/redknight.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971836969x906934230510867200/renegade.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971848155x700917702870914600/rock.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971859403x351742199570164000/sidewinder.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971870621x518726865909307140/sight.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971879636x972762521626031600/skimask.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971889966x356807496328367170/snorkel.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971901472x616489463244668900/splinter.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971912615x622738563145909000/sun.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971923852x956185444443834500/valkyrie.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971941487x138919831055788420/valor.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971954136x280444056383950300/viking.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971968856x971367826323432700/volleyball.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971988801x566902785511056400/whiteout.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972002170x139747593602844500/wildcard.webp"],
                bodies: ["https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703616876735x135560682636407090/default_invert.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703970834826x320815145781848900/artic.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703970846877x294456854053071200/basketball.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703970860592x954011405589725300/battle_blue.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703970875289x110683843781177230/brite.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703970891079x740972652264572000/bunny.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703970902791x894589929540081600/chrome.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703970913767x447105383115450100/cipher.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703970932206x696799389984400900/dazzle.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703970944049x671666842956398700/dino.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703970954068x628725820593630600/elite_agent.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703970964886x694543086376770800/fate.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703970973453x140839728718074480/ghoul.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703970986658x592543797495073200/liteshow.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971005646x468642647797408200/mogul.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971015826x862685598594746800/nog_ops.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971028792x842063152999301200/pinkbear.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971039545x169352308875738940/powerchord.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971052689x288344801343001900/radiant.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971066835x145935534964865440/redknight.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971077231x731851508693243500/scarlet.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971094041x732323563770108200/scuba.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971105694x480290754254303800/shadowops.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971120838x681025225094628900/soccer.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971133575x705067760340214500/soccer2.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971147454x536366157520209000/sparkle.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971159644x724863604265727200/steel.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971173435x970824333021434400/stripes.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971186354x112555955465671870/teknique.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971199959x817120152057856600/trailblazer.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971210863x826863037036151600/valor.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971220888x155055318432374620/ventura.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971323966x285044926704135700/viking.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703971360761x760727642605949400/whiplash.webp"],
                legs: ["https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972016562x870588570028440800/ao.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972025564x190933380994516830/astro.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972037084x434454406304411800/bk.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972048729x399928793072282560/bluechecker.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972085708x673088339307538200/brite.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972095340x963424196477258100/bt.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972104596x881953048874580000/cipher.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972114817x277496099064870940/dino.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972124658x567832524913405760/dz.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972138454x210932668357863400/ea.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972148496x246706056714136160/elf.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972159457x128062889507289280/ghoul.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972169888x975020444988711400/ginger.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972181864x319339430518986940/heidi.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972194709x370550927772101500/knights.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972209298x377584305453501300/mogul.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972220625x288970241226163000/nog_ops.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972231748x720300937709196300/pinkbear.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972249011x723475125087028000/rdt.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972260450x490922131791270400/red_knight.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972274022x694158955008972200/rk.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972283456x749293409065901000/scr.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972293812x203369403973544100/shadow.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972305016x136684410496698000/snrkl.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972316274x111558137294339730/sparkle.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972327649x174116239500163200/splinter.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972353793x674566988181458000/sun.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972363072x806213805942333600/sweats.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972373377x515835459937141060/sweats2.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972383469x590180037900565900/valor.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972392867x513823369179849700/viking.webp", "https://314783edf025a574d098c188c6ec838c.cdn.bubble.io/cdn-cgi/image/w=192,h=188,f=auto,dpr=1.25,fit=contain/f1703972403927x886118369987740200/whiteout.webp"]
            };

            let activeCategory = 'heads';
            let selectedIndices = { heads: 0, bodies: 0, legs: 0, backgrounds: 0 };
            let activeDraggable = null;
            let xOffset = 0;
            let yOffset = 0;

            function savePositions() {
                const positions = {
                    heads: { top: characterParts.heads.style.top, left: characterParts.heads.style.left, transform: characterParts.heads.style.transform },
                    bodies: { top: characterParts.bodies.style.top, left: characterParts.bodies.style.left, transform: characterParts.bodies.style.transform },
                    legs: { top: characterParts.legs.style.top, left: characterParts.legs.style.left, transform: characterParts.legs.style.transform }
                };
                localStorage.setItem('skinPositions', JSON.stringify(positions));
            }

            function loadPositions() {
                const savedPositions = localStorage.getItem('skinPositions');
                if (savedPositions) {
                    const positions = JSON.parse(savedPositions);
                    Object.keys(positions).forEach(part => {
                        if (positions[part].top && positions[part].left) {
                            characterParts[part].style.top = positions[part].top;
                            characterParts[part].style.left = positions[part].left;
                            characterParts[part].style.transform = positions[part].transform || 'none';
                        }
                    });
                }
            }

            function dragStart(e) {
                if (e.target.classList.contains('character-part')) {
                    activeDraggable = e.target;
                    
                    if (e.type === 'touchstart') {
                        xOffset = e.touches[0].clientX - activeDraggable.offsetLeft;
                        yOffset = e.touches[0].clientY - activeDraggable.offsetTop;
                    } else {
                        xOffset = e.clientX - activeDraggable.offsetLeft;
                        yOffset = e.clientY - activeDraggable.offsetTop;
                    }
                    document.addEventListener('mousemove', drag);
                    document.addEventListener('touchmove', drag);
                }
            }

            function dragEnd() {
                if (activeDraggable) {
                    activeDraggable = null;
                    savePositions();
                    document.removeEventListener('mousemove', drag);
                    document.removeEventListener('touchmove', drag);
                }
            }

            function drag(e) {
                if (activeDraggable) {
                    e.preventDefault();
                    let currentX, currentY;

                    if (e.type === 'touchmove') {
                        currentX = e.touches[0].clientX;
                        currentY = e.touches[0].clientY;
                    } else {
                        currentX = e.clientX;
                        currentY = e.clientY;
                    }

                    activeDraggable.style.left = (currentX - xOffset) + 'px';
                    activeDraggable.style.top = (currentY - yOffset) + 'px';
                    activeDraggable.style.transform = 'none';
                }
            }

            function renderPartsCarousel(category) {
                partsCarousel.innerHTML = '';
                items[category].forEach((itemUrl, index) => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'carousel-item flex-shrink-0 w-20 h-20 bg-black/50 rounded-lg cursor-pointer border-2 border-transparent hover:border-blue-500 active:scale-95 transition-all duration-200';
                    if (index === selectedIndices[category]) {
                        itemEl.classList.add('selected');
                    }
                    
                    const imgEl = document.createElement('img');
                    imgEl.src = itemUrl;
                    imgEl.alt = `${category} item ${index + 1}`;
                    imgEl.className = 'w-full h-full object-cover rounded-lg'; 
                    imgEl.onerror = () => { imgEl.src = 'https://placehold.co/150/ff0000/ffffff?text=Error'; };

                    itemEl.appendChild(imgEl);

                    itemEl.addEventListener('click', () => {
                        characterParts[category].src = itemUrl;
                        selectedIndices[category] = index;
                        renderPartsCarousel(category);
                    });
                    partsCarousel.appendChild(itemEl);
                });
            }

            function renderBackgroundCarousel() {
                backgroundCarousel.innerHTML = '';
                items.backgrounds.forEach((bg, index) => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'carousel-item flex-shrink-0 w-20 h-20 bg-black/50 rounded-lg cursor-pointer border-2 border-transparent hover:border-blue-500 active:scale-95 transition-all duration-200 bg-cover bg-center';
                    if (index === selectedIndices.backgrounds) {
                        itemEl.classList.add('selected');
                    }
                     if (bg.type === 'image') {
                        itemEl.style.backgroundImage = `url(${bg.url})`;
                    } else {
                        itemEl.style.background = bg.url;
                    }

                    itemEl.addEventListener('click', () => {
                        selectedIndices.backgrounds = index;
                        setBackground(bg);
                        renderBackgroundCarousel();
                    });
                    backgroundCarousel.appendChild(itemEl);
                });
            }

            function setBackground(bg) {
                 if (bg.type === 'image') {
                    characterDisplayBg.style.backgroundImage = `url(${bg.url})`;
                    characterDisplayBg.style.backgroundSize = 'cover';
                    characterDisplayBg.style.backgroundPosition = 'center';
                } else {
                    characterDisplayBg.style.backgroundImage = 'none';
                    characterDisplayBg.style.background = bg.url;
                }
            }

            function moveTabBackground(activeButton) {
                if (!activeButton) return;
                tabBackground.style.width = `${activeButton.offsetWidth}px`;
                tabBackground.style.height = `${activeButton.offsetHeight}px`;
                tabBackground.style.left = `${activeButton.offsetLeft}px`;
            }

            function setActiveTab(category) {
                activeCategory = category;
                let activeButton = null;
                tabButtons.forEach(button => {
                    const isActive = button.dataset.category === category;
                    button.classList.toggle('active', isActive);
                    if (isActive) {
                        activeButton = button;
                    }
                });
                moveTabBackground(activeButton);
                renderPartsCarousel(category);
            }
            
            function goToPartsSelection() {
                backgroundCarouselContainer.classList.add('hidden');
                partsSelectionContainer.classList.remove('hidden');
                nextButton.classList.add('opacity-0', 'pointer-events-none');
                backButton.classList.remove('opacity-0', 'pointer-events-none');
                constructorTitle.textContent = "Create your skin";
                setActiveTab('heads');
            }

            function goToBackgroundSelection() {
                backgroundCarouselContainer.classList.remove('hidden');
                partsSelectionContainer.classList.add('hidden');
                nextButton.classList.remove('opacity-0', 'pointer-events-none');
                backButton.classList.add('opacity-0', 'pointer-events-none');
                constructorTitle.textContent = "SELECT BACKGROUND";
            }

            // --- INITIALIZATION ---
            tabButtons.forEach(button => {
                button.addEventListener('click', () => setActiveTab(button.dataset.category));
            });
            backButton.addEventListener('click', goToBackgroundSelection);
            nextButton.addEventListener('click', goToPartsSelection);
            
            characterDisplayBg.addEventListener('mousedown', dragStart);
            characterDisplayBg.addEventListener('touchstart', dragStart);
            document.addEventListener('mouseup', dragEnd);
            document.addEventListener('touchend', dragEnd);


            // Initial setup
            constructorScreen.style.opacity = '1';
            constructorScreen.style.pointerEvents = 'auto';
            
            characterParts.heads.src = items.heads[selectedIndices.heads];
            characterParts.bodies.src = items.bodies[selectedIndices.bodies];
            characterParts.legs.src = items.legs[selectedIndices.legs];
            setBackground(items.backgrounds[selectedIndices.backgrounds]);

            renderBackgroundCarousel();
            loadPositions();
            
            // Set initial tab for when user navigates to parts selection
            setTimeout(() => {
                 const initialActiveButton = document.querySelector('.tab-btn[data-category="heads"]');
                 moveTabBackground(initialActiveButton);
            }, 100);


            window.addEventListener('resize', () => {
                const activeButton = document.querySelector('.tab-btn.active');
                moveTabBackground(activeButton);
            });
        });
    </script>
</body>
</html>
